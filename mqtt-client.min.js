var MqttClient=function(e){function n(){c.connected=!1,c.reconnect?setTimeout(function(){c.unbind("disconnect",n),c.connect()},c.reconnect):c.emitter.trigger("offline")}var t=Array.prototype.slice,i=function(e){return JSON.parse(JSON.stringify(e))},o=function(e,n,t,i){var o=new Paho.MQTT.Message(n);return o.destinationName=e,o.qos=Number(t)||0,o.retain=!!i,o},c=this;return c.connected=!1,c.broker=i({host:e.host,port:Number(e.port),clientId:e.clientId||"client-"+Math.random().toString(36).slice(-6)}),c.options=i({timeout:Number(e.timeout)||10,keepAliveInterval:Number(e.keepalive)||30,mqttVersion:e.mqttVersion||void 0,userName:e.username||void 0,password:e.password||void 0,useSSL:void 0!==e.ssl?e.ssl:!1,cleanSession:void 0!==e.clean?e.clean:!0,willMessage:e.will&&e.will.topic.length?e.will:void 0}),c.reconnect=e.reconnect,c.emitter={events:{},bind:function(e,n){return c.emitter.events[e]=c.emitter.events[e]||[],c.emitter.events[e].push(n),c},unbind:function(e,n){return e in c.emitter.events&&c.emitter.events[e].splice(c.emitter.events[e].indexOf(n),1),c},trigger:function(e){if(e in c.emitter.events)for(var n=0;n<c.emitter.events[e].length;++n)try{c.emitter.events[e][n].apply(c,t.call(arguments,1))}catch(e){setTimeout(function(){throw e})}}},c.on=c.emitter.bind,c.bind=c.emitter.bind,c.unbind=c.emitter.unbind,c.once=function(e,n){return c.on(e,function i(){n.apply(c,t.call(arguments)),c.unbind(e,i)}),c},c.client=new Paho.MQTT.Client(c.broker.host,c.broker.port,c.broker.clientId),c.client.onConnectionLost=c.emitter.trigger.bind(c,"disconnect"),c.messageCache=[],c.client.onMessageDelivered=function(e){c.messageCache.indexOf(e)>=0&&c.messageCache.splice(c.messageCache.indexOf(e))[0].callback()},c.client.onMessageArrived=function(e){c.emitter.trigger("message",e.destinationName,e.payloadString||e.payloadBytes,{topic:e.destinationName,qos:e.qos,retained:e.retained,payload:e.payloadBytes,duplicate:e.duplicate})},c.connect=function(){c.once("connect",function(){c.connected=!0}),c.once("disconnect",n);var e=i(c.options);return e.onSuccess=c.emitter.trigger.bind(c,"connect"),e.onFailure=c.emitter.trigger.bind(c,"disconnect"),e.willMessage&&(e.willMessage=o(e.willMessage.topic,e.willMessage.payload,e.willMessage.qos,e.willMessage.retain)),c.emitter.trigger("connecting"),c.client.connect(e),c},c.disconnect=function(){c.unbind("disconnect",n),c.client.disconnect(),c.emitter.trigger("offline")},c.subscribe=function(e,n,t){2===arguments.length&&"function"==typeof arguments[1]&&(t=n),c.client.subscribe(e,t?{qos:Number(n)||0,timeout:15,onSuccess:function(e){t.call(c,void 0,e.grantedQos[0])},onFailure:t.bind(c)}:{})},c.unsubscribe=function(e,n){c.client.unsubscribe(e,n?{timeout:15,onSuccess:n.bind(c,void 0),onFailure:n.bind(c)}:{})},c.publish=function(e,n,t,i){var s=o(e,n,t&&t.qos,t&&t.retain);i&&(s.qos<1?setTimeout(i):(s.callback=i,c.messageCache.push(s))),c.client.send(s)},c};