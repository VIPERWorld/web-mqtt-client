var MqttClient=function(e){"use strict";var t=Array.prototype.slice,n=function(e){return JSON.parse(JSON.stringify(e))},i=function(e,t,n,i){var s=new Paho.MQTT.Message(t);return s.destinationName=e,s.qos=Number(n)||0,s.retain=i||!1,s},s=this;return s.connected=!1,s.broker=n({host:e.host,port:Number(e.port),clientId:e.clientId||"client-"+Math.random().toString(36).slice(-6)}),s.options=n({timeout:Number(e.timeout)||10,useSSL:e.ssl||!1,cleanSession:e.clean||!0,keepAliveInterval:Number(e.keepalive)||30,mqttVersion:e.mqttVersion||void 0,userName:e.username||void 0,password:e.password||void 0,willMessage:e.will&&e.will.topic.length?e.will:void 0}),s.emitter={events:{},bind:function(e,t){return s.emitter.events[e]=s.emitter.events[e]||[],s.emitter.events[e].push(t),s},unbind:function(e,t){return e in s.emitter.events&&s.emitter.events[e].splice(s.emitter.events[e].indexOf(t),1),s},trigger:function(e){if(e in s.emitter.events)for(var n=0;n<s.emitter.events[e].length;++n)try{s.emitter.events[e][n].apply(s,t.call(arguments,1))}catch(e){setTimeout(function(){throw e})}}},s.on=s.emitter.bind,s.bind=s.emitter.bind,s.unbind=s.emitter.unbind,s.client=new Paho.MQTT.Client(s.broker.host,s.broker.port,s.broker.clientId),s.client.onConnectionLost=s.emitter.trigger.bind(s,"disconnect"),s.messageCache=[],s.client.onMessageDelivered=function(e){s.messageCache.indexOf(e)>=0&&s.messageCache.splice(s.messageCache.indexOf(e))[0].callback()},s.client.onMessageArrived=function(e){s.emitter.trigger("message",e.destinationName,e.payloadString||e.payloadBytes,{topic:e.destinationName,qos:e.qos,retained:e.retained,payload:e.payloadBytes,duplicate:e.duplicate})},s.connect=function(){s.on("connect",function(){s.connected=!0}),s.on("disconnect",function(){s.connected=!1});var e=n(s.options);return e.onSuccess=s.emitter.trigger.bind(s,"connect"),e.onFailure=s.emitter.trigger.bind(s,"disconnect"),e.willMessage&&(e.willMessage=i(e.willMessage.topic,e.willMessage.payload,e.willMessage.qos,e.willMessage.retain)),console.log(e),s.client.connect(e),s},s.disconnect=function(){s.client.disconnect()},s.subscribe=function(e,t,n){s.client.subscribe(e,n?{qos:Number(t)||0,timeout:15,onSuccess:n.bind(s,null),onFailure:n.bind()}:{})},s.unsubscribe=function(e,t){s.client.unsubscribe(e,t?{timeout:15,onSuccess:t.bind(s,null),onFailure:t.bind()}:{})},s.publish=function(e,t,n,o){var r=i(e,t,n.qos,n.retain);o&&(r.qos<1?setTimeout(function(){o()}):(r.callback=o,s.messageCache.push(r))),s.client.send(r)},s};